<!-- Copyright (C) 2020-2024 Oleksandr Masniuk -->
<!-- SPDX-License-Identifier: AGPL-3.0-or-later -->

<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="https://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      th:replace="~{layout/base :: layout(~{::title}, ~{::meta}, ~{::section}, ~{::#main-script-block}, true)}">
<head>
    <title>Stats - SC2 Pulse</title>
    <meta name="description" content="Comprehensive ladder statistics for StarCraft2. Online population, mmr ranking, race/league/region distribution, tier mmr ranges, match history, pro player unmasking and earnings."/>
</head>
<body data-view-name="global">
    <section>
        <header>
            <nav>
                <ul id="main-tabs" class="nav nav-fill nav-pills nav-pills-main mb-3 justify-content-center" role="tablist">
                    <li class="nav-item">
                        <a
                            id="stats-tab"
                            class="nav-link active"
                            data-toggle="pill"
                            data-target="#stats"
                            href="#stats"
                            role="tab"
                            aria-controls="stats"
                            aria-selected="true"
                        >
                            Stats
                        </a>
                    </li>
                    <li class="nav-item">
                        <a
                                id="online-tab"
                                class="nav-link"
                                data-toggle="pill"
                                data-target="#online"
                                href="#online"
                                role="tab"
                                aria-controls="online"
                                aria-selected="false"
                        >
                            Online
                        </a>
                    </li>
                    <li class="nav-item">
                        <a
                            id="search-all-tab"
                            class="nav-link"
                            data-toggle="pill"
                            data-target="#search-all"
                            href="#search-all"
                            role="tab"
                            aria-controls="search-all"
                            aria-selected="false"
                        >
                            Search
                        </a>
                    </li>
                    <li class="nav-item">
                        <a
                            id="personal-tab"
                            class="nav-link"
                            data-toggle="pill"
                            data-target="#personal"
                            href="#personal"
                            role="tab"
                            aria-controls="personal"
                            aria-selected="false"
                        >
                            <span class="tab-name">My</span>
                            <span class="tab-alert parenthesis d-none text-danger ml-1"></span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a
                                id="settings-tab"
                                class="nav-link"
                                data-toggle="pill"
                                data-target="#settings"
                                href="#settings"
                                role="tab"
                                aria-controls="settings"
                                aria-selected="false"
                        >
                            Settings
                        </a>
                    </li>
                </ul>
            </nav>
            <h1 class="text-dark no-popup-hide"><a th:href="@{/}"><img th:src="@{/static/icon/misc/pulse.svg}" class="mr-1"  alt="Pulse"/><span> SC2 Pulse</span></a></h1>
            <aside class="no-popup-hide" th:if="${@varService.getMessage('message.global') != null}" th:utext="${@varService.getMessage('message.global')}"></aside>
            <div class="c-divider-hr no-popup-hide"></div>
        </header>
        <div id="dd-small-header" class="dd-block mt-4 mb-4" th:if="${not #arrays.contains(@environment.getActiveProfiles(), 'dev')
                and @environment.getProperty('com.nephest.battlenet.sc2.google.ads.small.header.id') != null
                and !#authorization.expression('hasRole(''ROLE_SUPPORTER'')')}"
        >
            <!-- small-header -->
            <ins class="adsbygoogle dd-full-width"
                 th:data-ad-client="${@environment.getProperty('com.nephest.battlenet.sc2.google.ads.id')}"
                 th:data-ad-slot="${@environment.getProperty('com.nephest.battlenet.sc2.google.ads.small.header.id')}"></ins>
            <script>
            (adsbygoogle = window.adsbygoogle || []).push({});
            </script>
        </div>
        <div class="tab-content tab-content-main no-popup-hide">
        <section id="stats" class="tab-pane fade show active"
                 data-view-name="ladder"
                 data-view-title="Stats"
                 data-view-description="Comprehensive ladder statistics for StarCraft2. Online population, mmr ranking, race/league/region distribution, tier mmr ranges, match history, pro player unmasking and earnings."
        >
        <header>
            <h2><a id="generator-collapse" class="c-dropdown" href="#form-ladder" data-toggle="collapse" role="button" aria-expanded="true" aria-controls="form-ladder">Filters</a></h2>
            <div th:replace="~{fragments/generator-form :: form('form-ladder', 'generator-collapse', 'generated-info-all')}"></div>
        </header>
        <div id="generated-info-all" class="d-none">
        <nav>
            <ul id="stats-tabs" class="nav nav-fill nav-pills mb-3 justify-content-center" role="tablist">
                <li class="nav-item">
                    <a
                        id="ladder-tab"
                        class="nav-link active"
                        data-toggle="pill"
                        data-target="#ladder-top"
                        href="#ladder-top"
                        role="tab"
                        aria-controls="ladder-top"
                        aria-selected="true"
                    >
                        Ladder
                    </a>
                </li>
                <li class="nav-item">
                    <a
                        id="stats-global-tab"
                        class="nav-link"
                        data-toggle="pill"
                        data-target="#stats-global"
                        href="#stats-global"
                        role="tab"
                        aria-controls="stats-global"
                        aria-selected="false"
                    >
                        Global
                    </a>
                </li>
                <li class="nav-item">
                    <a
                        id="stats-day-tab"
                        class="nav-link"
                        data-toggle="pill"
                        data-target="#stats-day"
                        href="#stats-day"
                        role="tab"
                        aria-controls="stats-day"
                        aria-selected="false"
                    >
                        Activity
                    </a>
                </li>
                <li class="nav-item">
                    <a
                        id="stats-race-tab"
                        class="nav-link"
                        data-toggle="pill"
                        data-target="#stats-race"
                        href="#stats-race"
                        role="tab"
                        aria-controls="stats-race"
                        aria-selected="false"
                    >
                        Race
                    </a>
                </li>
                <li class="nav-item">
                    <a
                            id="stats-match-up-tab"
                            class="nav-link"
                            data-toggle="pill"
                            data-target="#stats-match-up"
                            href="#stats-match-up"
                            role="tab"
                            aria-controls="stats-match-up"
                            aria-selected="false"
                            data-feature-timestamp="1716913706000"
                            data-feature-timestamp-class="new-content"
                    >
                        Match-up
                    </a>
                </li>
                <li class="nav-item">
                    <a
                        id="stats-league-tab"
                        class="nav-link"
                        data-toggle="pill"
                        data-target="#stats-league"
                        href="#stats-league"
                        role="tab"
                        aria-controls="stats-league"
                        aria-selected="false"
                    >
                        League
                    </a>
                </li>
                <li class="nav-item">
                    <a
                        id="stats-region-tab"
                        class="nav-link"
                        data-toggle="pill"
                        data-target="#stats-region"
                        href="#stats-region"
                        role="tab"
                        aria-controls="stats-region"
                        aria-selected="false"
                    >
                        Region
                    </a>
                </li>
                <li class="nav-item">
                    <a
                        id="stats-tier-tab"
                        class="nav-link"
                        data-toggle="pill"
                        data-target="#stats-tier"
                        href="#stats-tier"
                        role="tab"
                        aria-controls="stats-tier"
                        aria-selected="false"
                    >
                        Tier
                    </a>
                </li>
            </ul>
        </nav>
        <div id="ladder-all" class="tab-content">
            <section id="ladder-top" class="tab-pane fade show active" data-view-title="MMR Ladder">
                <h3>MMR Ladder</h3>
                <nav class="pagination-container" aria-label="Ladder navigation top">
                    <ul class="pagination pagination-ladder justify-content-center flex-wrap d-none" data-pagination-anchor="#generated-info-all"></ul>
                </nav>
                <div th:replace="~{fragments/table :: team('ladder-table-container', 'ladder', '', _)}"></div>
                <nav class="pagination-container" aria-label="Ladder navigation bottom">
                    <ul class="pagination pagination-ladder justify-content-center flex-wrap d-none" data-pagination-anchor="#generated-info-all"></ul>
                </nav>
            </section>
            <section id="stats-global" class="tab-pane fade c-height-linked" data-view-title="Global statistics">
                <h3>Global stats</h3>
                <div class="row no-gutters">
                    <section id="games-played-global" class="col-lg-6 mb-3"
                             th:replace="~{fragments/section :: stats('games-played-global', ~{::#games-played-global/h4}, 'Games', 'line')}"
                    >
                        <h4>Games played</h4>
                    </section>
                    <section id="team-count-global" class="col-lg-6 mb-3"
                             th:replace="~{fragments/section :: stats('team-count-global', ~{::#team-count-global/h4}, 'Teams', 'line')}"
                    >
                        <h4>Team count</h4>
                    </section>
                    <section id="player-count-global" class="col-lg-6 mb-3"
                             th:replace="~{fragments/section :: stats('player-count-global', ~{::#player-count-global/h4}, 'Players', 'line')}"
                    >
                        <h4>Player count
                            (<img
                                    th:src="@{/static/icon/misc/filter.svg}"
                                    alt="Some filters are not applicable: region, league"
                                    title="Some filters are not applicable: region, league"
                                    data-toggle="tooltip"
                            />)
                        </h4>
                    </section>
                    <section id="player-count-daily-activity-tier" class="col-lg-6 mb-3"
                             th:replace="~{fragments/section :: stats('player-count-daily-activity-tier', ~{::#player-count-daily-activity-tier/h4}, 'Players', 'line')}"
                    >
                        <h4>Player count by activity tier
                            (
                            <img
                                    th:src="@{/static/icon/misc/filter.svg}"
                                    alt="Some filters are not applicable: region, league"
                                    title="Some filters are not applicable: region, league"
                                    data-toggle="tooltip"
                            />
                            <img
                                    th:src="@{/static/icon/misc/info.svg}"
                                    alt="Games played per day tiers. Low: <0.3. Medium: 0.3-1. High: >1."
                                    title="Games played per day tiers. Low: <0.3. Medium: 0.3-1. High: >1."
                                    data-toggle="tooltip"
                            />
                            )
                        </h4>
                    </section>
                </div>
            </section>
            <section id="stats-day" class="tab-pane fade c-height-linked" data-view-title="Daily activity statistics">
                <h3>Daily activity stats</h3>
                <div class="row no-gutters">
                    <section
                            id="games-played-day" class="col-lg-6 mb-3"
                            th:replace="~{fragments/section :: stats('games-played-day', ~{::#games-played-day/h4}, 'Games/day', 'line')}"
                    >
                        <h4>Games played per day</h4>
                    </section>
                    <section
                            id="team-count-day" class="col-lg-6 mb-3"
                            th:replace="~{fragments/section :: stats('team-count-day', ~{::#team-count-day/h4}, 'New teams/day', 'line')}"
                    >
                        <h4>New teams per day</h4>
                    </section>
                    <section
                            id="player-count-day" class="col-lg-6 mb-3"
                            th:replace="~{fragments/section :: stats('player-count-day', ~{::#player-count-day/h4}, 'New players/day', 'line')}"
                    >
                        <h4>New players per day
                            (<img
                                    th:src="@{/static/icon/misc/filter.svg}"
                                    alt="Some filters are not applicable: region, league"
                                    title="Some filters are not applicable: region, league"
                                    data-toggle="tooltip"
                            />)
                        </h4>
                    </section>
                    <section
                            id="player-count-daily-activity-tier-day" class="col-lg-6 mb-3"
                            th:replace="~{fragments/section :: stats('player-count-daily-activity-tier-day', ~{::#player-count-daily-activity-tier-day/h4}, 'Players/day', 'line')}"
                    >
                        <h4>New players per day by activity tier
                            (
                            <img
                                    th:src="@{/static/icon/misc/filter.svg}"
                                    alt="Some filters are not applicable: region, league"
                                    title="Some filters are not applicable: region, league"
                                    data-toggle="tooltip"
                            />
                            <img
                                    th:src="@{/static/icon/misc/info.svg}"
                                    alt="Games played per day tiers. Low: <0.3. Medium: 0.3-1. High: >1."
                                    title="Games played per day tiers. Low: <0.3. Medium: 0.3-1. High: >1."
                                    data-toggle="tooltip"
                            />
                            )
                        </h4>
                    </section>
                </div>
                <p>
                    This sections contains normalized global stats. These are the stats as if all seasons have the same duration.
                    The main idea here is to highlight the dynamics
                    rather then absolute numbers. Seasons have a different length, so longer seasons will inevitably have
                    higher numbers, creating misleading positive bumps in the charts. This stats section normalizes
                    the stats by dividing global numbers by season duration(in days), which results in smoother
                    graphs.
                </p>
            </section>
            <section id="stats-race" class="tab-pane fade c-height-linked" data-view-title="Race distribution">
                <h3>Race distribution</h3>
                <form class="form-inline form-inline-flex flex-center-wrap-gap mb-3">
                    <div class="form-group">
                        <label for="stats-race-type" class="text-nowrap">Y axis</label>
                        <select id="stats-race-type" class="form-control serializable stats-race-ctl">
                            <option value="games-played">Games</option>
                            <option value="team-count" selected="selected">Teams</option>
                        </select>
                    </div>
                    <div class="form-check form-check-inline">
                        <input type="checkbox"
                               id="stats-race-normalize"
                               name="stats-race-normalize"
                               class="form-check-input serializable stats-race-ctl"
                        />
                        <label for="stats-race-normalize" class="text-nowrap form-check-label">Normalize</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input
                                type="checkbox"
                                id="stats-race-deviation"
                                name="stats-race-deviation"
                                class="form-check-input serializable stats-race-ctl"
                                data-state-link-id="stats-race-normalize"
                                data-state-link-values="1"
                        />
                        <label for="stats-race-deviation" class="text-nowrap form-check-label mr-1">Deviation</label>
                        <span
                             class="icofont-info text-primary"
                             title="Deviation from ideal distribution. Normalized stats are required."
                             data-toggle="tooltip"
                        ></span>
                    </div>
                </form>
                <div class="row no-gutters ml-3">
                    <section id="games-played-race" class="col-lg-6 mb-3"
                             th:replace="~{fragments/section :: stats('games-played-race', ~{::#games-played-race/h4}, '%', 'line')}"
                    >
                        <h4 class="header"><span class="main">Games played by race</span> (%)</h4>
                    </section>
                    <section th:replace="~{fragments/section :: stats-race-league-region('global')}"></section>
                    <section th:replace="~{fragments/section :: stats-race-league-region('us')}"></section>
                    <section th:replace="~{fragments/section :: stats-race-league-region('eu')}"></section>
                    <section th:replace="~{fragments/section :: stats-race-league-region('kr')}"></section>
                    <section th:replace="~{fragments/section :: stats-race-league-region('cn')}"></section>
                </div>
                <p class="msg-info"></p>
            </section>
            <section id="stats-match-up" class="tab-pane fade c-height-linked" data-view-title="Match-up statistics">
                <h3>
                    <a class="c-dropdown"
                       href="#stats-match-up-form"
                       data-toggle="collapse"
                       role="button"
                       aria-expanded="true"
                       aria-controls="stats-match-up-form"
                    >
                        Match-up stats
                    </a>
                </h3>
                <form id="stats-match-up-form"
                      class="collapse show form-inline d-flex form-flex form-group-column flex-wrap-gap row-gap-1-5 justify-content-center mb-3"
                      data-collapse-on="mobile"
                >
                    <div class="d-flex flex-wrap-gap form-group-container">
                        <div class="form-group checkbox d-flex align-items-center flex-wrap-gap-05"
                             th:each="race : ${T(com.nephest.battlenet.sc2.model.Race).values()}"
                        >
                            <input th:id="|stats-match-up-race-${race.name()}|"
                                   class="stats-match-up-reload serializable"
                                   type="checkbox"
                                   name="race"
                                   th:value="${race.name()}"
                                   th:attrappend="checked=${race.name() != 'RANDOM'}?@{checked}"
                            />
                            <label class="form-check-label" th:for="|stats-match-up-race-${race.name()}|">
                                <div th:class="|icofont icofont-${race.name().toLowerCase} form-font|" th:title="${race.name()}"></div>
                            </label>
                        </div>
                    </div>
                    <div class="d-flex flex-wrap-gap form-group-container">
                        <div class="form-group d-flex flex-wrap-gap-05">
                            <label for="stats-match-up-league">League</label>
                            <select id="stats-match-up-league" class="form-control serializable stats-match-up-reload">
                                <th:block th:each="league : ${@serverSideRenderService.reverseOrder(T(com.nephest.battlenet.sc2.model.BaseLeague.LeagueType).values())}">
                                    <th:block th:each="tier : ${T(com.nephest.battlenet.sc2.model.BaseLeagueTier.LeagueTierType).values()}">
                                        <option
                                                th:unless="${league.name() == 'GRANDMASTER' and tier.name() != 'FIRST'}"
                                                th:value="|${league.getId()},${tier.getId()}|"
                                                th:text="|${league.getName()} ${league.name() != 'GRANDMASTER' ? tier.getName() : ''}|"
                                                th:attrappend="selected=${league.name() == 'MASTER' and tier.name() == 'FIRST'}?@{selected}"
                                        >
                                        </option>
                                    </th:block>
                                </th:block>
                            </select>
                        </div>
                        <div class="form-group checkbox d-flex align-items-center flex-wrap-gap-05">
                            <input id="stats-match-up-cross-tier"
                                   class="stats-match-up-reload serializable"
                                   type="checkbox"
                                   name="cross-tier"
                            />
                            <label class="form-check-label d-flex gap-tiny" for="stats-match-up-cross-tier">
                                Cross-tier
                                <img
                                        th:src="@{/static/icon/misc/info.svg}"
                                        alt="Disabled: all match participants were in the target tier.
                                            Enabled: at least one match participant was in the target tier."
                                        title="Disabled: all match participants were in the target tier.
                                            Enabled: at least one match participant was in the target tier."
                                        data-toggle="tooltip"
                                />
                            </label>
                        </div>
                    </div>
                    <div class="d-flex flex-wrap-gap form-group-container">
                        <fieldset class="form-group short d-flex flex-wrap-gap-05">
                            <label for="stats-match-up-win-rate-fov" class="d-flex gap-tiny">
                                Win% FoV
                                <img
                                        th:src="@{/static/icon/misc/info.svg}"
                                        alt="Y scales length of the win rate/duration chart, starting from 50 in both directions. 0 is auto FoV based on data."
                                        title="Y scales length of the win rate/duration chart, starting from 50 in both directions. 0 is auto FoV based on data."
                                        data-toggle="tooltip"
                                />
                            </label>
                            <input id="stats-match-up-win-rate-fov" class="form-control serializable"
                                   type="number" min="0" max="50"
                                   required="required"/>
                        </fieldset>
                        <fieldset class="form-group short d-flex flex-wrap-gap-05">
                            <label for="stats-match-up-group-duration" class="d-flex gap-tiny">
                                Step duration
                                <img
                                    th:src="@{/static/icon/misc/info.svg}"
                                    alt="Duration of chart groups(points), minutes. Low duration provides fine grained stats, but
                                        smaller sample size. High duration provides generalized stats and larger sample size."
                                    title="Duration of chart groups(points), minutes. Low duration provides fine grained stats, but
                                        smaller sample size. High duration provides generalized stats and larger sample size."
                                    data-toggle="tooltip"
                                />
                            </label>
                            <input id="stats-match-up-group-duration" class="form-control serializable"
                                   type="number" min="1" max="10"
                                   required="required"/>
                        </fieldset>
                    </div>
                    <div class="d-flex flex-wrap-gap form-group-container">
                        <div class="form-group d-flex flex-wrap-gap-05">
                            <label for="stats-match-up-highlight">Highlight</label>
                            <select id="stats-match-up-highlight" class="form-control serializable">
                                <option value="win-rate" selected="selected">Win rate</option>
                                <option value="games">Games</option>
                            </select>
                        </div>
                        <fieldset class="form-group short d-flex flex-wrap-gap-05">
                            <label for="stats-match-up-win-rate-highlight-threshold" class="d-flex gap-tiny">
                                Win% threshold
                                <img
                                        th:src="@{/static/icon/misc/info.svg}"
                                        alt="Deviation from 50 at which the highlight is set to 100% intensity. For example
                                        5 threshold means that win rates of 45% and below and 55% and above will be
                                        highlighted with max intensity."
                                        title="Deviation from 50 at which the highlight is set to 100% intensity. For example
                                        5 threshold means that win rates of 45% and below and 55% and above will be
                                        highlighted with max intensity."
                                        data-toggle="tooltip"
                                />
                            </label>
                            <input id="stats-match-up-win-rate-highlight-threshold" class="form-control serializable"
                                   type="number" min="0.5" max="50" step="0.5"
                                   required="required"
                                   data-state-link-id="stats-match-up-highlight"
                                   data-state-link-values="win-rate"/>
                        </fieldset>
                        <div class="form-group d-flex flex-wrap-gap-05">
                            <label for="stats-match-up-color">Color</label>
                            <select id="stats-match-up-color"
                                    class="form-control serializable"
                                    data-state-link-id="stats-match-up-highlight"
                                    data-state-link-values="win-rate"
                            >
                                <option value="red-green">Red/Green</option>
                                <option value="race" selected="selected">Race</option>
                            </select>
                        </div>
                    </div>
                </form>
                <div>
                    <div id="stats-match-up-container" class="container-loading loading-none">
                        <div th:replace="~{fragments/section :: loading-indicator}"></div>
                    </div>
                    <aside>
                        <p>
                            These stats are calculated using the following rules:
                        <dl>
                            <dt>Top% based leagues are used</dt>
                            <dd>
                                There are no demotions(excluding GM) in SC2, and league borders are often broken,
                                so I use real top% leagues to mitigate these issues.
                            </dd>

                            <dt>Only valid matches are used</dt>
                            <dd>
                                Match history reconstruction is not an easy process, some matches may be missing or
                                contain invalid data. Only valid data is used, so the game numbers will be much lower than the
                                actual global game count, but the data set should be large enough to derive the stats from it.
                            </dd>

                            <dt>First week of the season is skipped</dt>
                            <dd>
                                The ladder is very volatile at the beginning of new season and it is hard to determine
                                players' leagues.
                            </dd>

                            <dt>Match duration uses approximate values</dt>
                            <dd>
                                There is no way to get the exact match duration via the API, so I use match and MMR history
                                of all match participants to calculate approximate duration.
                            </dd>
                        </dl>
                        </p>
                    </aside>
                </div>
            </section>
            <section id="stats-league" class="tab-pane fade c-height-linked" data-view-title="League distribution">
                <h3>League distribution</h3>
                <div class="row no-gutters">
                    <section
                            id="games-played-league" class="col-lg-6 mb-3"
                            th:replace="~{fragments/section :: stats('games-played-league', ~{::#games-played-league/h4}, '%', 'line')}"
                    >
                        <h4>Games played by league (%)</h4>
                    </section>
                    <section
                            id="team-count-league" class="col-lg-6 mb-3"
                            th:replace="~{fragments/section :: stats('team-count-league', ~{::#team-count-league/h4}, '%', 'line')}"
                    >
                        <h4>Team count by league (%)</h4>
                    </section>
                    <section
                            id="team-count-region-league" class="col-lg-6 mb-3"
                            th:replace="~{fragments/section :: stats('team-count-region-league', ~{::#team-count-region-league/h4}, '%', 'bar')}"
                    >
                        <h4>Team count by league (<span class="season-current"></span>) (%)</h4>
                    </section>
                </div>
            </section>
            <section id="stats-region" class="tab-pane fade c-height-linked" data-view-title="Region distribution">
                <h3>Region distribution</h3>
                <div class="row no-gutters">
                    <section
                            id="games-played-region" class="col-lg-6 mb-3"
                            th:replace="~{fragments/section :: stats('games-played-region', ~{::#games-played-region/h4}, '%', 'line')}"
                    >
                        <h4>Games played by region (%)</h4>
                    </section>
                    <section
                            id="team-count-region" class="col-lg-6 mb-3"
                            th:replace="~{fragments/section :: stats('team-count-region', ~{::#team-count-region/h4}, '%', 'line')}"
                    >
                        <h4>Team count by region (%)</h4>
                    </section>
                </div>
            </section>
            <section id="stats-tier" class="tab-pane fade" data-view-title="Tier MMR ranges">
                <div class="table-responsive">
                    <table id="league-bounds-table" class="table table-sm table-hover">
                        <caption><h3>Tier MMR ranges</h3></caption>
                        <thead>
                            <tr>
                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>
            </section>
        </div><!--Ladder all-->
        </div><!--Generated all-->
        </section><!--Generator-->
        <section th:replace="~{fragments/main-section :: online}"></section>
        <section th:replace="~{fragments/search :: search}"></section>
        <section id="personal" class="tab-pane fade"
                 data-view-title="Personal"
                 data-view-description="Log in with your BattleNet account and get an easy access to your personal data.
              See your statistics, follow favorite players, create a personal ladder."
        >
            <h2>Personal</h2>
            <div class="login-anonymous">
                <h3>Log in</h3>
                <div th:replace="~{fragments/main-section :: login}"></div>
            </div>
            <div class="login-user d-none">
                <nav>
                    <ul id="personal-tabs" class="nav nav-fill nav-pills mb-3 justify-content-center" role="tablist">
                        <li class="nav-item">
                            <a
                                    id="personal-following-tab"
                                    class="nav-link"
                                    data-toggle="pill"
                                    data-target="#personal-following"
                                    href="#personal-following"
                                    role="tab"
                                    aria-controls="personal-following"
                                    aria-selected="false"
                            >
                                Ladder
                            </a>
                        </li>
                        <li class="nav-item">
                            <a
                                    id="personal-following-characters-tab"
                                    class="nav-link"
                                    data-toggle="pill"
                                    data-target="#personal-following-characters"
                                    href="#personal-following-characters"
                                    role="tab"
                                    aria-controls="personal-following-characters"
                                    aria-selected="false"
                            >
                                Following
                            </a>
                        </li>
                        <li class="nav-item">
                            <a
                                    id="personal-characters-tab"
                                    class="nav-link active"
                                    data-toggle="pill"
                                    data-target="#personal-characters"
                                    href="#personal-characters"
                                    role="tab"
                                    aria-controls="personal-characters"
                                    aria-selected="true"
                            >
                                Characters
                            </a>
                        </li>
                        <li class="nav-item" sec:authorize="hasAnyRole('MODERATOR', 'ADMIN')">
                            <a
                                    id="all-character-reports-tab"
                                    class="nav-link"
                                    data-toggle="pill"
                                    data-target="#all-character-reports"
                                    href="#all-character-reports"
                                    role="tab"
                                    aria-controls="all-character-reports"
                                    aria-selected="false"
                            >
                                <span class="tab-name">Reports</span>
                                <span class="tab-alert parenthesis d-none text-danger ml-1"></span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a
                                    id="personal-account-tab"
                                    class="nav-link"
                                    data-toggle="pill"
                                    data-target="#personal-account"
                                    href="#personal-account"
                                    role="tab"
                                    aria-controls="personal-account"
                                    aria-selected="false"
                            >
                                Account
                            </a>
                        </li>
                    </ul>
                </nav>
                <div class="tab-content">
                    <section
                            id="personal-characters"
                            class="tab-pane fade show active"
                            data-view-name="personal-characters"
                            data-view-title="Personal characters"
                    >
                        <div th:replace="~{fragments/table :: player-search('personal-characters-table', 'Your characters', '')}"></div>
                        <p th:replace="~{fragments/section :: missing-characters-message}"></p>
                    </section>
                    <section id="personal-account" class="tab-pane fade" data-view-title="Personal account">
                        <h3>Account</h3>
                        <div class="d-flex justify-content-center align-items-center flex-wrap gap-1 mb-3">
                            <span id="login-battletag" class="d-inline-block"></span>
                            <span class="parenthesis text-secondary text-lowercase d-inline-block" id="login-roles"></span>
                            <form class="form-csrf d-inline-block" th:action="@{/logout}" method="post">
                                <button type="submit" class="btn btn-primary">Log out</button>
                            </form>
                        </div>
                        <p th:insert="~{/fragments/section :: missing-battle-tag-message}"></p>
                        <section id="account-linked-accounts">
                            <h4>Linked services</h4>
                            <div class="eligible">
                                <p>Linked accounts are visible to all users within the service scope(see "Effects" column).
                                You can make your data available to all SC2 Pulse users by enabling the "Public" option.
                                Currently, public connections are displayed in the "Links" section of
                                the corresponding SC2 Pulse profile.</p>
                                <div class="table-responsive">
                                    <table id="account-linked-accounts-table" class="table inline-table" >
                                        <thead>
                                            <tr>
                                                <th>Service</th>
                                                <th>Account</th>
                                                <th>Effects</th>
                                                <th>Public</th>
                                                <th>Action</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr id="account-connection-discord">
                                                <td><img src="/static/icon/logo/discord.svg" th:src="@{/static/icon/logo/discord.svg}" alt="discord" title="discord" class="table-image-md"></td>
                                                <td class="dynamic account-connection-name"></td>
                                                <td>
                                                    Acquisition of <a th:href="@{/discord/bot#role-management}">linked roles and auto roles</a>.
                                                    Discord user commands will use your BattleTag instead of Discord username.
                                                </td>
                                                <td class="dynamic account-connection-public"></td>
                                                <td class="dynamic account-connection-action"></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <div class="ineligible d-none">
                                <p>Unfortunately Blizzard API doesn't provide enough info about your account atm, therefore this section has been disabled.
                                    Try again when a new season starts, or when a new sc2 patch(even a minor one) is released.</p>
                            </div>
                        </section>
                        <a class="mb-3" th:href="@{/settings/advanced}">Advanced settings</a>
                        <div id="account-additional-info" class="mb-3"></div>
                    </section>
                    <section
                            id="personal-following"
                            class="tab-pane fade"
                            data-view-name="following-ladder"
                            data-view-title="Personal ladder"
                    >
                        <h3><a id="following-generator-collapse" class="c-dropdown" href="#form-following-ladder" data-toggle="collapse" role="button" aria-expanded="true" aria-controls="form-following-ladder">Filters</a></h3>
                        <div th:replace="~{fragments/generator-form :: form('form-following-ladder', 'following-generator-collapse', 'following-ladder')}"></div>
                        <p>This ladder consists of players you follow. You can follow a player by clicking the "Follow"
                            button in the player info section(click on a player to get there, the button is located at the bottom of the section). When following a player,
                            you will follow all their profiles in all regions. You can follow
                            <span th:text="${@accountFollowingService.getFollowingMax()}" th:remove="tag"></span> players max.
                        </p>
                        <div th:replace="~{fragments/table :: team('following-ladder-container', 'following-ladder', 'd-none', _)}"></div>
                    </section>
                    <section id="personal-following-characters"
                             class="tab-pane fade"
                             data-view-title="Following"
                             data-view-name="following-characters"
                    >
                        <div th:replace="~{fragments/table :: player-search('following-characters-table', 'Players you follow', '')}"></div>
                    </section>
                    <section
                            id="all-character-reports"
                            class="tab-pane fade"
                            data-view-name="all-character-reports"
                            data-view-title="All player reports"
                            sec:authorize="hasAnyRole('MODERATOR', 'ADMIN')"
                    >
                        <h3>Reports</h3>
                        <ul>
                            <li th:text="|Votes required: ${@evidenceDAO.getRequiredVotes()}|"></li>
                            <li>Next update: <span class="datetime-iso" th:text="${T(com.nephest.battlenet.sc2.config.Cron).getNextCharacterReportUpdateTime().toString()}"></span></li>
                            <li th:text="|Mods: ${#strings.listJoin(@userController.getModTags(), ', ')}|"></li>
                        </ul>
                        <form id="load-all-character-reports">
                            <div>
                                <div class="form-check form-check-inline mb-3">
                                    <input id="character-report-only-unreviewed" class="form-check-input serializable" type="checkbox" name="only-unreviewed"/>
                                    <label th:for="character-report-only-unreviewed" class="form-check-label">Only unreviewed</label>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary mb-3">Refresh</button>
                        </form>
                        <div class="character-reports"></div>
                    </section>
                </div>
            </div>
        </section>
        <section th:replace="~{fragments/main-section :: settings}"></section>

        </div><!--Tab content-->
        <div class="c-divider-hr no-popup-hide"></div>
        <section th:replace="~{fragments/app :: modal}"></section>
    </section><!--Container-->
    <script id="main-script-block">$(document).ready(function(){SC2Restful.start();});</script>
</body>
</html>
